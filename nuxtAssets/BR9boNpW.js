import{l as J,d as Y,u as Q,m as X,p as Z,q as ee,v as te,o as ae,n as m,s as ne,r as A,x as ie,c as g,b,e as l,k as D,f as x,g as O,_ as oe,F as M,h as se,y as re,t as P,j as _,z as le,w as de,T as ce,A as V,S as k,B as ue,C as L,E as H,G as me,H as K}from"./dVWTdz__.js";var j={exports:{}},fe=j.exports,W;function we(){return W||(W=1,function(z,q){(function(s,C){z.exports=C()})(fe,function(){return function s(C,F,R){var r=window,u="application/octet-stream",v=R||u,o=C,f=!F&&!R&&o,d=document.createElement("a"),$=function(n){return String(n)},w=r.Blob||r.MozBlob||r.WebKitBlob||$,t=F||"download",e,i;if(w=w.call?w.bind(r):Blob,String(this)==="true"&&(o=[o,v],v=o[0],o=o[1]),f&&f.length<2048&&(t=f.split("/").pop().split("?")[0],d.href=f,d.href.indexOf(f)!==-1)){var a=new XMLHttpRequest;return a.open("GET",f,!0),a.responseType="blob",a.onload=function(n){s(n.target.response,t,u)},setTimeout(function(){a.send()},0),a}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(o))if(o.length>1024*1024*1.999&&w!==$)o=B(o),v=o.type||u;else return navigator.msSaveBlob?navigator.msSaveBlob(B(o),t):y(o);else if(/([\x80-\xff])/.test(o)){var c=0,p=new Uint8Array(o.length),N=p.length;for(c;c<N;++c)p[c]=o.charCodeAt(c);o=new w([p],{type:v})}e=o instanceof w?o:new w([o],{type:v});function B(n){var h=n.split(/[:;,]/),S=h[1],G=h[2]=="base64"?atob:decodeURIComponent,U=G(h.pop()),E=U.length,T=0,I=new Uint8Array(E);for(T;T<E;++T)I[T]=U.charCodeAt(T);return new w([I],{type:S})}function y(n,h){if("download"in d)return d.href=n,d.setAttribute("download",t),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout(function(){d.click(),document.body.removeChild(d),h===!0&&setTimeout(function(){r.URL.revokeObjectURL(d.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(n)&&(n="data:"+n.replace(/^data:([\w\/\-\+]+)/,u)),window.open(n)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=n),!0;var S=document.createElement("iframe");document.body.appendChild(S),!h&&/^data:/.test(n)&&(n="data:"+n.replace(/^data:([\w\/\-\+]+)/,u)),S.src=n,setTimeout(function(){document.body.removeChild(S)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(e,t);if(r.URL)y(r.URL.createObjectURL(e),!0);else{if(typeof e=="string"||e.constructor===$)try{return y("data:"+v+";base64,"+r.btoa(e))}catch{return y("data:"+v+","+encodeURIComponent(e))}i=new FileReader,i.onload=function(n){y(this.result)},i.readAsDataURL(e)}return!0}})}(j)),j.exports}var pe=we();const ve=J(pe),ge={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},be={class:"px-4 py-6 sm:px-0"},ye={class:"flex justify-between items-center mb-4"},xe={class:"bg-white dark:bg-gray-800 overflow-hidden shadow bg-inherit rounded-lg divide-y divide-gray-200 dark:divide-gray-700"},he={key:0},_e={class:"flex gap-2"},ke=["onClick"],Ce=["onClick"],$e=["onClick"],Se=["onClick"],Te=["onClick"],De={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Fe={class:"flex justify-end space-x-2"},Re={key:0,class:"fixed inset-0 bg-white dark:bg-gray-800 z-50"},Be={class:"absolute inset-1/2 -translate-x-1/2 -translate-y-1/2 md:w-80 w-9/12"},Ae={class:"text-center mb-2"},qe=Y({__name:"settings",setup(z){Q({title:"Settings - CRK2"});const q=X("warn_unsaved"),s=Z([]);ee(s,(t,e)=>{localStorage.setItem("contexts",JSON.stringify(te(t)))}),ae(async()=>{await m(),ne(!1);let t=localStorage.getItem("contexts");if(t){let e=JSON.parse(t);Object.assign(s,e)}else s.push({id:1,name:"Default",active:!0})});async function C(){let t=await V("New Context","Context Name","Create");if(!t.trim())return;u.value=`Creating ${t.trim()}...`,r.value=!0,await new Promise(c=>setTimeout(c,1e3)),await m();let e={id:s.length==0?1:s[s.length-1].id+1,name:t.trim(),active:!1};s.push(e),await m();const{sql:i,destroy:a}=new k(`${e.id}.sqlite3`);await i(ue),await a(),await m(),r.value=!1,await m()}async function F(t){let e=await V("Rename Context","Context Name","Rename",t.name);if(e.trim()){q.value=!0,await m();for(let i=0;i<s.length;i++)if(s[i].id==t.id){s[i].name=e.trim();break}await m(),q.value=!1}}async function R(t){if(!await L("Delete Context",`Are you sure you want to delete the context "${t.name}"?`))return;u.value=`Deleting ${t.name}...`,r.value=!0,await new Promise(a=>setTimeout(a,1e3)),await m();for(let a=0;a<s.length;a++)if(s[a].id==t.id){s.splice(a,1);break}const{deleteDatabaseFile:i}=new k(`${t.id}.sqlite3`);await i(),await m(),r.value=!1,await m()}const r=A(!1),u=A("");async function v(t){let e;if(u.value=`Exporting ${t.name}...`,r.value=!0,await new Promise(i=>setTimeout(i,1e3)),t.active)e=await H();else{const{getDatabaseFile:i,destroy:a}=new k(`${t.id}.sqlite3`);e=await i(),await a()}r.value=!1,ve(e,`${t.name}.db`,"application/x-sqlite3")}const o=A(!1),f=ie("importFile"),d=A(void 0);async function $(t){if(!await L("Warning",`Are you sure you want to import into context "${t.name}"? All existing data will be lost.`)||(d.value=void 0,o.value=!0,await me(o).toBe(!1),!d.value)||d.value.length==0)return;u.value=`Importing to ${t.name}...`,r.value=!0,await new Promise(a=>setTimeout(a,1e3));const i=d.value[0];if(t.active)await K(i);else{const{overwriteDatabaseFile:a,destroy:c}=new k(`${t.id}.sqlite3`);await a(i),await c()}await m(),r.value=!1}async function w(t){if(!await L("Warning",`Are you sure you want to switch to context "${t.name}"?`))return;u.value=`Switching to ${t.name}...`,r.value=!0,await new Promise(n=>setTimeout(n,1e3));let i;for(let n=0;n<s.length;n++)if(s[n].active){i=s[n],s[n].active=!1;break}const a=await H(),{overwriteDatabaseFile:c,destroy:p}=new k(`${i.id}.sqlite3`);await c(a),await p();const{getDatabaseFile:N,destroy:B}=new k(`${t.id}.sqlite3`),y=await N();await B(),await K(y);for(let n=0;n<s.length;n++)if(s[n].id==t.id){s[n].active=!0;break}await m(),r.value=!1}return(t,e)=>{const i=oe;return b(),g(M,null,[l("main",ge,[l("div",be,[l("div",ye,[e[4]||(e[4]=l("h2",{class:"text-2xl font-semibold"},"Contexts",-1)),l("button",{class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded flex items-center",onClick:C},[x(i,{name:"majesticons:plus",class:"mr-2"}),e[3]||(e[3]=O(" New Context "))])]),e[5]||(e[5]=l("div",{class:"text-gray-500 dark:text-gray-400 mb-4"}," Each context has independent sets of teams, players and matches. You can compare a context to a tournament. You can switch between contexts, and import/export data for a context. ",-1)),l("div",xe,[(b(!0),g(M,null,se(_(s),(a,c)=>(b(),g("div",{class:"px-4 py-3 flex justify-between",key:c},[l("div",{class:re([a.active?"font-bold":""])},[O(P(a.name)+" ",1),a.active?(b(),g("span",he,"(Active)")):D("",!0)],2),l("div",_e,[a.active?D("",!0):(b(),g("button",{key:0,class:"flex items-center",title:"activate",onClick:p=>w(a)},[x(i,{name:"majesticons:alert-circle-line",size:"1.3rem"})],8,ke)),l("button",{class:"flex items-center",title:"rename",onClick:p=>F(a)},[x(i,{name:"majesticons:edit-pen-2",size:"1.3rem"})],8,Ce),a.active?D("",!0):(b(),g("button",{key:1,class:"flex items-center",title:"delete",onClick:p=>R(a)},[x(i,{name:"majesticons:delete-bin",size:"1.3rem"})],8,$e)),l("button",{class:"flex items-center",title:"import",onClick:p=>$(a)},[x(i,{name:"majesticons:login-half-circle-line",size:"1.3rem"})],8,Se),l("button",{class:"flex items-center",title:"export",onClick:p=>v(a)},[x(i,{name:"majesticons:logout-half-circle-line",size:"1.3rem"})],8,Te)])]))),128))])])]),_(o)?(b(),g("div",De,[l("form",{class:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",onSubmit:e[2]||(e[2]=le(a=>{var c;o.value=!1,d.value=(c=_(f))==null?void 0:c.files},["prevent"]))},[e[6]||(e[6]=l("h2",{class:"text-lg font-medium mb-4 text-gray-900 dark:text-gray-100"}," Select File To Import From ",-1)),l("input",{ref_key:"importFile",ref:f,type:"file",id:"importFile",class:"w-full px-3 py-2 border border-gray-300 outline-none rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white mb-4"},null,512),l("div",Fe,[l("button",{onClick:e[0]||(e[0]=a=>o.value=!1),type:"button",class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700"}," Cancel "),l("button",{onClick:e[1]||(e[1]=a=>{var c;o.value=!1,d.value=(c=_(f))==null?void 0:c.files}),type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"}," OK ")])],32)])):D("",!0),x(ce,{name:"progress-overlay"},{default:de(()=>[_(r)?(b(),g("div",Re,[l("div",Be,[l("div",Ae,P(_(u)),1)])])):D("",!0)]),_:1})],64)}}});export{qe as default};
