import{d as Z,u as J,z as X,A as ee,a1 as te,r as c,K as ae,o as oe,n as A,s as se,G as re,c as i,a as u,b as t,j as T,i as s,M as b,P as D,Z as y,F as I,g as L,t as v,N as O,e as M,_ as le,w as ne,a2 as w,H as E}from"./BftIUcDm.js";import{u as de,f as ie}from"./6W00xMzA.js";import{D as P,a as ue}from"./Bcq5nZh3.js";const me={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},ce={class:"px-4 py-6 sm:px-0"},ve={key:0,class:"bg-white dark:bg-gray-800 shadow overflow-hidden rounded-lg p-6"},pe={class:"mb-4"},ge=["value"],be={class:"mb-4"},ye=["value","disabled"],fe={class:"mb-4"},xe=["value"],ke=["value"],he={class:"mb-4"},we={class:"mb-4"},_e={class:"mb-4"},Ce={key:1,class:"bg-white dark:bg-gray-800 shadow overflow-hidden rounded-lg p-6"},Te={class:"text-xl font-medium mb-2"},De={class:"flex gap-2"},Me=["onClick"],Pe=["onClick"],Se={class:"flex items-center justify-between bg-gray-100 dark:bg-gray-700 p-2 rounded"},Ve={class:"text-gray-400 mr-3 font-semibold"},Ie={class:"flex items-center gap-2"},Le={class:"flex justify-between"},Ne={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},je={class:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md"},Ae={class:"text-lg font-medium mb-4 text-gray-900 dark:text-gray-100"},Ee={class:"max-h-60 overflow-y-auto mb-4"},Ue=["onClick"],Fe=Z({__name:"new-match",setup($e){J({title:"New Match - CRK2"});const W=X(),U=ee("warn_unsaved"),N=de(ie(te(()=>P.team.toArray()))),g=c([[],[],[]]),S=c(1),l=c(""),d=c(""),p=c(""),_=c(""),f=c(20),V=c("no"),n=c([[],[],[]]),j=c(!1),x=c(0),k=c(""),h=o=>{var r;const e=(r=N.value)==null?void 0:r.find(m=>m.id===o);return e?e.name:""},z=o=>g.value[o]||[],F=async()=>{if(l.value==""||d.value==""||p.value==""||_.value==""){await w("Error","Please complete all fields");return}if(l.value==d.value){d.value="",await w("Error","Team 1 and Team 2 cannot be same");return}if(![l.value,d.value].includes(p.value)){p.value="",await w("Error","Either team 1 or team 2 must win the toss");return}if(!/^\d+$/.test(f.value.toString())||f.value<=0){await w("Error","Number of overs must be a positive integer");return}g.value[parseInt(l.value)]=await P.player.where({teamID:parseInt(l.value)}).toArray(),g.value[parseInt(d.value)]=await P.player.where({teamID:parseInt(d.value)}).toArray(),g.value[parseInt(l.value)].sort((o,e)=>o.order-e.order),g.value[parseInt(d.value)].sort((o,e)=>o.order-e.order),n.value[parseInt(l.value)]=[],n.value[parseInt(d.value)]=[],S.value=2},K=async o=>{let e=await P.match.where("team1ID").equals(o).or("team2ID").equals(o).last();if(!e){await w("Error","No previous match found for this team");return}e.team1ID==o?n.value[o]=e.team1PlayerIDs.map(r=>g.value[o].find(m=>m.id==r)):n.value[o]=e.team2PlayerIDs.map(r=>g.value[o].find(m=>m.id==r))},R=async o=>{x.value=o,k.value="",await A(),j.value=!0},$=()=>{j.value=!1,k.value=""},q=ae(()=>{if(x.value==0)return[];const o=z(x.value),e=new Set(n.value[x.value].map(r=>r.id));return o.filter(r=>!e.has(r.id)&&r.name.toLowerCase().includes(k.value.toLowerCase()))}),H=(o,e)=>{n.value[o].push(e),$()},G=(o,e)=>{n.value[o].splice(e,1)},Q=async()=>{let o=parseInt(l.value),e=parseInt(d.value);if(p.value==l.value!=(_.value=="bat")){let m=e;e=o,o=m}if(n.value[o].length<2||n.value[e].length<2){await w("Error","Each team must have at least 2 players");return}if(n.value[o].length!=11&&!await E("Warning",`${h(o)} doesn't have exactly 11 players in their lineup. Do you want to proceed?`)||n.value[e].length!=11&&!await E("Warning",`${h(e)} doesn't have exactly 11 players in their lineup. Do you want to proceed?`)||n.value[o].length!=n.value[e].length&&!await E("Warning","Both teams don't have the same number of players in their lineup. Do you want to proceed?"))return;U.value=!0,await A();let r=new ue(o,e,f.value*6,n.value[o].map(m=>m.id),n.value[e].map(m=>m.id),p.value==o.toString(),V.value=="yes");await P.match.add(r),U.value=!1,W.push(`/match/${r.id}`)};return oe(async()=>{await A(),se(!1)}),(o,e)=>{const r=le,m=re("draggable");return u(),i("div",me,[t("div",ce,[e[21]||(e[21]=t("h1",{class:"text-3xl font-semibold mb-6"},"Create New Match ",-1)),s(S)===1?(u(),i("div",ve,[e[19]||(e[19]=t("h2",{class:"text-2xl font-medium mb-4"},"Team Selection and Toss",-1)),t("div",pe,[e[9]||(e[9]=t("label",{for:"team1",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Team 1",-1)),b(t("select",{id:"team1","onUpdate:modelValue":e[0]||(e[0]=a=>y(l)?l.value=a:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[e[8]||(e[8]=t("option",{value:""},"Select Team 1",-1)),(u(!0),i(I,null,L(s(N),a=>(u(),i("option",{key:a.id,value:a.id},v(a.name),9,ge))),128))],512),[[D,s(l)]])]),t("div",be,[e[11]||(e[11]=t("label",{for:"team2",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Team 2",-1)),b(t("select",{id:"team2","onUpdate:modelValue":e[1]||(e[1]=a=>y(d)?d.value=a:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[e[10]||(e[10]=t("option",{value:""},"Select Team 2",-1)),(u(!0),i(I,null,L(s(N),a=>(u(),i("option",{key:a.id,value:a.id,disabled:a.id+""==s(l)},v(a.name),9,ye))),128))],512),[[D,s(d)]])]),t("div",fe,[e[13]||(e[13]=t("label",{for:"tossWinner",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Toss Winner",-1)),b(t("select",{id:"tossWinner","onUpdate:modelValue":e[2]||(e[2]=a=>y(p)?p.value=a:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[e[12]||(e[12]=t("option",{value:""},"Select Toss Winner",-1)),s(l)?(u(),i("option",{key:0,value:s(l)},v(h(parseInt(s(l)))),9,xe)):T("",!0),s(d)?(u(),i("option",{key:1,value:s(d)},v(h(parseInt(s(d)))),9,ke)):T("",!0)],512),[[D,s(p)]])]),t("div",he,[e[15]||(e[15]=t("label",{for:"tossDecision",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Toss Decision",-1)),b(t("select",{id:"tossDecision","onUpdate:modelValue":e[3]||(e[3]=a=>y(_)?_.value=a:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},e[14]||(e[14]=[t("option",{value:""},"Select Decision",-1),t("option",{value:"bat"},"Bat",-1),t("option",{value:"bowl"},"Bowl",-1)]),512),[[D,s(_)]])]),t("div",we,[e[16]||(e[16]=t("label",{for:"numberOfOvers",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Number of overs",-1)),b(t("input",{id:"numberOfOvers","onUpdate:modelValue":e[4]||(e[4]=a=>y(f)?f.value=a:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md bg-gray-100 dark:bg-gray-700 dark:border-gray-600 dark:text-white",type:"number",step:"1"},null,512),[[O,s(f)]])]),t("div",_e,[e[18]||(e[18]=t("label",{for:"knockoutMatch",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Knockout Match (if yes, this match will not be considered for standings) ",-1)),b(t("select",{id:"knockoutMatch","onUpdate:modelValue":e[5]||(e[5]=a=>y(V)?V.value=a:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},e[17]||(e[17]=[t("option",{value:"yes"},"Yes",-1),t("option",{value:"no"},"No",-1)]),512),[[D,s(V)]])]),t("button",{onClick:F,class:"mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded"}," Proceed to Lineup Selection ")])):T("",!0),s(S)===2?(u(),i("div",Ce,[e[20]||(e[20]=t("h2",{class:"text-2xl font-medium mb-4"},"Lineup Selection",-1)),(u(!0),i(I,null,L([parseInt(s(l)),parseInt(s(d))],(a,Y)=>(u(),i("div",{key:a,class:"mb-6"},[t("h3",Te,v(h(a))+" Lineup",1),t("div",De,[t("button",{onClick:C=>K(a),class:"mb-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white flex items-center",title:"last lineup"},[M(r,{name:"majesticons:reload"})],8,Me),t("button",{onClick:C=>R(a),class:"mb-2 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex items-center",title:"add player"},[M(r,{name:"majesticons:plus"})],8,Pe)]),M(m,{modelValue:s(n)[a],"onUpdate:modelValue":C=>s(n)[a]=C,"ghost-class":"opacity-50",handle:".handle",class:"mb-4 space-y-2"},{item:ne(({element:C,index:B})=>[t("div",Se,[t("div",null,[t("span",Ve,v(B+1)+".",1),t("span",null,v(C.name),1)]),t("div",Ie,[M(r,{role:"button",onClick:Be=>G(a,B),name:"majesticons:close",size:"1.5rem"},null,8,["onClick"]),M(r,{name:"majesticons:menu",size:"1.5rem",class:"handle"})])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),t("div",Le,[t("button",{onClick:e[6]||(e[6]=a=>S.value=1),class:"mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white"}," Back "),t("button",{onClick:Q,class:"mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"}," Create ")])])):T("",!0),s(j)?(u(),i("div",Ne,[t("div",je,[t("h2",Ae,"Add Player to "+v(h(s(x))),1),b(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>y(k)?k.value=a:null),type:"text",placeholder:"Search for a player",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm outline-none dark:bg-gray-700 dark:border-gray-600 dark:text-white mb-4"},null,512),[[O,s(k)]]),t("ul",Ee,[(u(!0),i(I,null,L(s(q),a=>(u(),i("li",{key:a.id,onClick:Y=>H(s(x),a),class:"cursor-pointer p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded"},v(a.name),9,Ue))),128))]),t("div",{class:"flex justify-end"},[t("button",{onClick:$,class:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500"}," Close ")])])])):T("",!0)])])}}});export{Fe as default};
