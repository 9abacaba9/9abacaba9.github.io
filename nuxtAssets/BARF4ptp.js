import{d as oe,u as se,I as re,m as le,p as ne,r as m,J as de,o as ie,D,K as F,n as E,s as ue,L as me,c as i,b as u,e as t,k as M,j as s,N as g,O as P,P as b,F as I,h as L,t as p,Q as R,f as z,_ as ce,w as pe,R as h,U as w,V as N,W as K,M as j,X as ve,a as ge,C as O}from"./dVWTdz__.js";import{M as q}from"./SskoH84V.js";import{T as be}from"./CcTuiQ7E.js";const ye={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},fe={class:"px-4 py-6 sm:px-0"},xe={key:0,class:"bg-white dark:bg-gray-800 shadow overflow-hidden rounded-lg p-6"},ke={class:"mb-4"},he=["value"],we={class:"mb-4"},_e=["value","disabled"],Ce={class:"mb-4"},Te=["value"],De=["value"],Me={class:"mb-4"},Pe={class:"mb-4"},ze={class:"mb-4"},Se={key:1,class:"bg-white dark:bg-gray-800 shadow overflow-hidden rounded-lg p-6"},Ve={class:"text-xl font-medium mb-2"},Be={class:"flex gap-2"},Ie=["onClick"],Le=["onClick"],Ne={class:"flex items-center justify-between bg-gray-100 dark:bg-gray-700 p-2 rounded"},je={class:"text-gray-400 mr-3 font-semibold"},Ue={class:"flex items-center gap-2"},Ee={class:"flex justify-between"},Oe={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},We={class:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md"},$e={class:"text-lg font-medium mb-4 text-gray-900 dark:text-gray-100"},Ae={class:"max-h-60 overflow-y-auto mb-4"},Fe=["onClick"],Qe=oe({__name:"new-match",setup(Re){se({title:"New Match - CRK2"});const H=re(),W=le("warn_unsaved"),S=ne([]),_=m([[],[],[]]),V=m(1),n=m(""),d=m(""),v=m(""),C=m(""),y=m(20),B=m("no"),l=m([[],[],[]]),U=m(!1),f=m(0),x=m(""),k=a=>{const e=S.find(r=>r.id===a);return e?e.name:""},J=a=>_.value[a]||[],Q=async()=>{if(n.value==""||d.value==""||v.value==""||C.value==""){await h("Error","Please complete all fields");return}if(n.value==d.value){d.value="",await h("Error","Team 1 and Team 2 cannot be same");return}if(![n.value,d.value].includes(v.value)){v.value="",await h("Error","Either team 1 or team 2 must win the toss");return}if(!/^\d+$/.test(y.value.toString())||y.value<=0){await h("Error","Number of overs must be a positive integer");return}_.value[parseInt(n.value)]=(await D.select().from(w).where(N(w.teamID,parseInt(n.value))).orderBy(w.order).all()).map(a=>K.from_drizzle(a)),_.value[parseInt(d.value)]=(await D.select().from(w).where(N(w.teamID,parseInt(d.value))).orderBy(w.order).all()).map(a=>K.from_drizzle(a)),l.value[parseInt(n.value)]=[],l.value[parseInt(d.value)]=[],V.value=2},X=async a=>{let e=(await D.select().from(j).where(ve(N(j.team1ID,a),N(j.team2ID,a))).orderBy(ge(j.id)).limit(1)).map(r=>q.from_drizzle(r))[0];if(!e){await h("Error","No previous match found for this team");return}e.team1ID==a?l.value[a]=e.team1PlayerIDs.map(r=>_.value[a].find(c=>c.id==r)):l.value[a]=e.team2PlayerIDs.map(r=>_.value[a].find(c=>c.id==r))},Y=async a=>{f.value=a,x.value="",await E(),U.value=!0},$=()=>{U.value=!1,x.value=""},G=de(()=>{if(f.value==0)return[];const a=J(f.value),e=new Set(l.value[f.value].map(r=>r.id));return a.filter(r=>!e.has(r.id)&&r.name.toLowerCase().includes(x.value.toLowerCase()))}),Z=(a,e)=>{l.value[a].push(e),$()},ee=(a,e)=>{l.value[a].splice(e,1)},te=async()=>{let a=parseInt(n.value),e=parseInt(d.value);if(v.value==n.value!=(C.value=="bat")){let c=e;e=a,a=c}if(l.value[a].length<2||l.value[e].length<2){await h("Error","Each team must have at least 2 players");return}if(l.value[a].length!=11&&!await O("Warning",`${k(a)} doesn't have exactly 11 players in their lineup. Do you want to proceed?`)||l.value[e].length!=11&&!await O("Warning",`${k(e)} doesn't have exactly 11 players in their lineup. Do you want to proceed?`)||l.value[a].length!=l.value[e].length&&!await O("Warning","Both teams don't have the same number of players in their lineup. Do you want to proceed?"))return;W.value=!0,await E();let r=new q(a,e,y.value*6,l.value[a].map(c=>c.id),l.value[e].map(c=>c.id),v.value==a.toString(),B.value=="yes");await r.save(D),W.value=!1,H.push(`/match/${r.id}`)};return ie(async()=>{Object.assign(S,(await D.select().from(F).orderBy(F.id).all()).map(a=>be.from_drizzle(a))),await E(),ue(!1)}),(a,e)=>{const r=ce,c=me("draggable");return u(),i("div",ye,[t("div",fe,[e[21]||(e[21]=t("h1",{class:"text-3xl font-semibold mb-6"},"Create New Match ",-1)),s(V)===1?(u(),i("div",xe,[e[19]||(e[19]=t("h2",{class:"text-2xl font-medium mb-4"},"Team Selection and Toss",-1)),t("div",ke,[e[9]||(e[9]=t("label",{for:"team1",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Team 1",-1)),g(t("select",{id:"team1","onUpdate:modelValue":e[0]||(e[0]=o=>b(n)?n.value=o:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[e[8]||(e[8]=t("option",{value:""},"Select Team 1",-1)),(u(!0),i(I,null,L(s(S),o=>(u(),i("option",{key:o.id,value:o.id},p(o.name),9,he))),128))],512),[[P,s(n)]])]),t("div",we,[e[11]||(e[11]=t("label",{for:"team2",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Team 2",-1)),g(t("select",{id:"team2","onUpdate:modelValue":e[1]||(e[1]=o=>b(d)?d.value=o:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[e[10]||(e[10]=t("option",{value:""},"Select Team 2",-1)),(u(!0),i(I,null,L(s(S),o=>(u(),i("option",{key:o.id,value:o.id,disabled:o.id+""==s(n)},p(o.name),9,_e))),128))],512),[[P,s(d)]])]),t("div",Ce,[e[13]||(e[13]=t("label",{for:"tossWinner",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Toss Winner",-1)),g(t("select",{id:"tossWinner","onUpdate:modelValue":e[2]||(e[2]=o=>b(v)?v.value=o:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[e[12]||(e[12]=t("option",{value:""},"Select Toss Winner",-1)),s(n)?(u(),i("option",{key:0,value:s(n)},p(k(parseInt(s(n)))),9,Te)):M("",!0),s(d)?(u(),i("option",{key:1,value:s(d)},p(k(parseInt(s(d)))),9,De)):M("",!0)],512),[[P,s(v)]])]),t("div",Me,[e[15]||(e[15]=t("label",{for:"tossDecision",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Toss Decision",-1)),g(t("select",{id:"tossDecision","onUpdate:modelValue":e[3]||(e[3]=o=>b(C)?C.value=o:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},e[14]||(e[14]=[t("option",{value:""},"Select Decision",-1),t("option",{value:"bat"},"Bat",-1),t("option",{value:"bowl"},"Bowl",-1)]),512),[[P,s(C)]])]),t("div",Pe,[e[16]||(e[16]=t("label",{for:"numberOfOvers",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Number of overs",-1)),g(t("input",{id:"numberOfOvers","onUpdate:modelValue":e[4]||(e[4]=o=>b(y)?y.value=o:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md bg-gray-100 dark:bg-gray-700 dark:border-gray-600 dark:text-white",type:"number",step:"1"},null,512),[[R,s(y)]])]),t("div",ze,[e[18]||(e[18]=t("label",{for:"knockoutMatch",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Knockout Match (if yes, this match will not be considered for standings) ",-1)),g(t("select",{id:"knockoutMatch","onUpdate:modelValue":e[5]||(e[5]=o=>b(B)?B.value=o:null),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"},e[17]||(e[17]=[t("option",{value:"yes"},"Yes",-1),t("option",{value:"no"},"No",-1)]),512),[[P,s(B)]])]),t("button",{onClick:Q,class:"mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded"}," Proceed to Lineup Selection ")])):M("",!0),s(V)===2?(u(),i("div",Se,[e[20]||(e[20]=t("h2",{class:"text-2xl font-medium mb-4"},"Lineup Selection",-1)),(u(!0),i(I,null,L([parseInt(s(n)),parseInt(s(d))],(o,ae)=>(u(),i("div",{key:o,class:"mb-6"},[t("h3",Ve,p(k(o))+" Lineup",1),t("div",Be,[t("button",{onClick:T=>X(o),class:"mb-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white flex items-center",title:"last lineup"},[z(r,{name:"majesticons:reload"})],8,Ie),t("button",{onClick:T=>Y(o),class:"mb-2 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex items-center",title:"add player"},[z(r,{name:"majesticons:plus"})],8,Le)]),z(c,{modelValue:s(l)[o],"onUpdate:modelValue":T=>s(l)[o]=T,"ghost-class":"opacity-50",handle:".handle",class:"mb-4 space-y-2"},{item:pe(({element:T,index:A})=>[t("div",Ne,[t("div",null,[t("span",je,p(A+1)+".",1),t("span",null,p(T.name),1)]),t("div",Ue,[z(r,{role:"button",onClick:Ke=>ee(o,A),name:"majesticons:close",size:"1.5rem"},null,8,["onClick"]),z(r,{name:"majesticons:menu",size:"1.5rem",class:"handle"})])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),t("div",Ee,[t("button",{onClick:e[6]||(e[6]=o=>V.value=1),class:"mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white"}," Back "),t("button",{onClick:te,class:"mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"}," Create ")])])):M("",!0),s(U)?(u(),i("div",Oe,[t("div",We,[t("h2",$e,"Add Player to "+p(k(s(f))),1),g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>b(x)?x.value=o:null),type:"text",placeholder:"Search for a player",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm outline-none dark:bg-gray-700 dark:border-gray-600 dark:text-white mb-4"},null,512),[[R,s(x)]]),t("ul",Ae,[(u(!0),i(I,null,L(s(G),o=>(u(),i("li",{key:o.id,onClick:ae=>Z(s(f),o),class:"cursor-pointer p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded"},p(o.name),9,Fe))),128))]),t("div",{class:"flex justify-end"},[t("button",{onClick:$,class:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500"}," Close ")])])])):M("",!0)])])}}});export{Qe as default};
